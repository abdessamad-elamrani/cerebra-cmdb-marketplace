{
  "title": "AD User Enumeration with PowerView",
  "description": "Enumerating domain users and checking 'badpwdcount' to identify safe targets for password spraying using PowerView.",
  "version": "3.0",
  "viewport": {
    "zoom": 1.1,
    "pan": {
      "x": 100,
      "y": 50
    }
  },
  "shortDescription": "Enumerate AD users and password status",
  "tags": [
    "AD",
    "PowerView",
    "Enumeration",
    "PowerShell",
    "Password_Spraying",
    "Reconnaissance",
    "Windows"
  ],
  "metadata": {
    "descriptionHtml": "<p><span style='color:#ef4444;font-weight:bold;'>PowerView</span> is a PowerShell tool to gain network situational awareness on Windows domains. The command <span style='color:#ef4444;font-weight:bold;'>Get-DomainUser</span> retrieves user objects from the Domain Controller via LDAP.</p><p>In this scenario, the attacker specifically requests the <strong>badpwdcount</strong> property. This is a critical pre-attack reconnaissance step:</p><ol><li><strong>Import Module</strong>: Load the PowerView script into the current PowerShell session.</li><li><strong>Query LDAP</strong>: Request a list of all users and their specific properties.</li><li><strong>Analyze Safety</strong>: Check <strong>badpwdcount</strong> to identify users who already have failed login attempts.</li><li><strong>Target Selection</strong>: Attackers avoid spraying accounts with a high bad password count to prevent locking them out and triggering alerts.</li></ol>",
    "commandsBlock": "# Step 1: Load PowerView into session\nPS> Import-Module .\\PowerView.ps1\n\n# Step 2: Enumerate users and check bad password count\nPS> Get-DomainUser -Properties name,badpwdcount",
    "prerequisites": [
      "Access to a domain-joined host or network position with LDAP access",
      "Valid low-privilege domain credentials (required for LDAP queries)",
      "PowerView.ps1 script present on disk"
    ],
    "attackerGains": [
      "List of valid domain usernames",
      "Insight into account lockout proximity (badpwdcount)",
      "Identification of potential targets for password spraying"
    ],
    "detectionNotes": [
      "Monitor for large volumes of LDAP queries from non-DC hosts",
      "PowerShell Script Block Logging (Event ID 4104) capturing 'Get-DomainUser'",
      "Unusual process execution loading unsigned PowerShell modules"
    ],
    "mitreCategories": [
      "T1087.002",
      "T1059.001",
      "T1069.002"
    ],
    "extraInfo": [
      "PowerSploit (PowerView) - [https://github.com/PowerShellMafia/PowerSploit](https://github.com/PowerShellMafia/PowerSploit)",
      "MITRE T1087.002 - Account Discovery: Domain Account",
      "MITRE T1059.001 - Command and Scripting Interpreter: PowerShell",
      "SharpView - C# implementation of PowerView"
    ]
  },
  "entities": [
    {
      "id": "attacker",
      "label": "Attacker",
      "position": {
        "x": 600,
        "y": 100
      },
      "icon": "IconAttacker",
      "type": "node"
    },
    {
      "id": "corporate_network",
      "label": "Corporate Network",
      "position": {
        "x": 242,
        "y": 221.5
      },
      "icon": "IconCloud",
      "type": "container",
      "width": 500,
      "height": 400,
      "style": "dashed_border",
      "members": [
        "domain_controller",
        "victim_workstation"
      ]
    },
    {
      "id": "domain_controller",
      "label": "Domain Controller",
      "position": {
        "x": 100,
        "y": 100
      },
      "icon": "IconServer",
      "type": "node"
    },
    {
      "id": "victim_workstation",
      "label": "Compromised Host",
      "position": {
        "x": 255.25,
        "y": 310.5
      },
      "icon": "IconWorkstation",
      "type": "container",
      "width": 350,
      "height": 180,
      "style": "dashed_border",
      "members": [
        "user_terminal",
        "powerview_file",
        "user_list_data"
      ]
    },
    {
      "id": "user_terminal",
      "label": "PowerShell",
      "position": {
        "x": 150,
        "y": 300
      },
      "icon": "IconTerminal",
      "type": "node"
    },
    {
      "id": "powerview_file",
      "label": "PowerView.ps1",
      "position": {
        "x": 350,
        "y": 300
      },
      "icon": "IconCode",
      "type": "node"
    },
    {
      "id": "user_list_data",
      "label": "User Objects",
      "position": {
        "x": 150,
        "y": 450
      },
      "icon": "IconData",
      "type": "node"
    }
  ],
  "visibility": {
    "attacker": {
      "start": 0,
      "end": 100
    },
    "corporate_network": {
      "start": 0,
      "end": 100
    },
    "domain_controller": {
      "start": 0,
      "end": 100
    },
    "victim_workstation": {
      "start": 0,
      "end": 100
    },
    "user_terminal": {
      "start": 0,
      "end": 100
    },
    "powerview_file": {
      "start": 0,
      "end": 100
    },
    "user_list_data": {
      "start": 3,
      "end": 100
    }
  },
  "steps": [
    {
      "id": 1,
      "name": "Import-Module",
      "mitre": {
        "id": "T1059.001",
        "tactic": "Execution",
        "technique": "PowerShell"
      },
      "type": "edge",
      "from": "powerview_file",
      "to": "user_terminal",
      "icon": "IconProcess",
      "tooltip": "Loads the PowerView script capabilities into the active PowerShell session",
      "cli": "Import-Module .\\PowerView.ps1"
    },
    {
      "id": 2,
      "name": "LDAP Query (Request)",
      "mitre": {
        "id": "T1087.002",
        "tactic": "Discovery",
        "technique": "Account Discovery: Domain Account"
      },
      "type": "edge",
      "from": "user_terminal",
      "to": "domain_controller",
      "icon": "IconSearch",
      "tooltip": "Queries the Domain Controller for all user objects, requesting specific properties",
      "cli": "Get-DomainUser -Properties name,badpwdcount"
    },
    {
      "id": 3,
      "name": "Return User Data",
      "mitre": {
        "id": "T1087.002",
        "tactic": "Discovery",
        "technique": "Account Discovery: Domain Account"
      },
      "type": "edge",
      "from": "domain_controller",
      "to": "user_terminal",
      "icon": "IconData",
      "tooltip": "DC returns list of users including 'badpwdcount' status"
    },
    {
      "id": 4,
      "name": "Display Results",
      "type": "edge",
      "from": "user_terminal",
      "to": "user_list_data",
      "icon": "IconTerminal",
      "tooltip": "PowerShell displays the formatted user list to the operator"
    }
  ]
}