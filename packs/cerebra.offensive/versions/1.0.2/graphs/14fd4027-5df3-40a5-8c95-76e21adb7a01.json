{
  "title": "Remote Credential Dumping with Impacket Secretsdump",
  "description": "Remotely extracting sensitive credential material (SAM, LSA secrets) from a target Windows machine using administrative credentials and the Remote Registry service.",
  "version": "3.0",
  "viewport": {
    "zoom": 0.837804597205713,
    "pan": {
      "x": 557.6844018527102,
      "y": 319.8974247633694
    }
  },
  "stepInfoPosition": {
    "x": 58.5,
    "y": 142.203125
  },
  "shortDescription": "Remote dump of SAM/LSA hashes",
  "tags": [
    "AD",
    "NTLM",
    "Credential_Dumping",
    "Impacket",
    "Remote_Registry",
    "Post-Exploitation",
    "Lateral_Movement"
  ],
  "metadata": {
    "descriptionHtml": "<h3>Tool & Attack Description</h3>\n<p>This scenario demonstrates usage of <span style='color:#ef4444;font-weight:bold;'>impacket-secretsdump</span> to perform remote credential dumping without deploying a persistent agent. By leveraging valid administrative credentials, the attacker connects via SMB and uses the <span style='color:#ef4444;font-weight:bold;'>Remote Registry</span> service to save the SAM, SYSTEM, and SECURITY hives to disk, then retrieves them to extract NTLM hashes and LSA secrets.</p>\n<h3>How attack works</h3>\n<ol>\n<li><strong>Authentication</strong>: Connect to target SMB service with admin credentials.</li>\n<li><strong>Service Activation</strong>: Ensure Remote Registry service is running via SCM.</li>\n<li><strong>Hive Export</strong>: Use <code>RegSaveKey</code> to save registry hives to <code>C:/Windows/Temp/</code>.</li>\n<li><strong>Exfiltration</strong>: Download the temporary hive files over SMB.</li>\n<li><strong>Cleanup & Decryption</strong>: Delete remote files and parse hives offline to recover hashes.</li>\n</ol>",
    "commandsBlock": "# Execute secretsdump against remote target\n$ impacket-secretsdump marvel/fcastle:Password1@10.0.2.72\n\n# Output:\n# [*] Target system bootKey: 0x1a2b3c...\n# [*] Dumping local SAM hashes (uid:rid:lmhash:nthash)\n# Administrator:500:aad3b435...:31d6cfe0d...\n# Guest:501:aad3b435...:31d6cfe0d...\n# [*] Dumping LSA Secrets..."
  },
  "entities": [
    {
      "id": "attacker_machine",
      "label": "Attacker (Kali)",
      "position": {
        "x": -522.8915531636728,
        "y": 39.35795865004197
      },
      "icon": "IconKali",
      "type": "container",
      "members": [
        "secretsdump_tool",
        "stolen_hashes"
      ]
    },
    {
      "id": "target_env",
      "label": "Corporate Network",
      "icon": "IconNetwork",
      "type": "container",
      "members": [
        "target_machine"
      ]
    },
    {
      "id": "target_machine",
      "label": "Windows Target (10.0.2.72)",
      "position": {
        "x": -3.6278424669679055,
        "y": 109.05658276065219
      },
      "icon": "IconWindows",
      "type": "container",
      "members": [
        "smb_service",
        "scm_service",
        "registry_store",
        "temp_hives"
      ]
    },
    {
      "id": "secretsdump_tool",
      "label": "impacket-secretsdump",
      "position": {
        "x": -565.4974474346502,
        "y": 150.7882984262675
      },
      "icon": "IconTerminal",
      "type": "node"
    },
    {
      "id": "smb_service",
      "label": "SMB Service (445)",
      "position": {
        "x": 169.86259537749947,
        "y": 210.64909736381315
      },
      "icon": "IconService",
      "type": "node"
    },
    {
      "id": "scm_service",
      "label": "Service Control Manager",
      "position": {
        "x": -32.595087685480195,
        "y": 294.9858167849359
      },
      "icon": "IconService",
      "type": "node"
    },
    {
      "id": "registry_store",
      "label": "Registry (SAM/SYSTEM)",
      "position": {
        "x": -161.11828031143529,
        "y": -97.87265126363151
      },
      "icon": "IconDatabase",
      "type": "node"
    },
    {
      "id": "temp_hives",
      "label": "Temp Hive Files",
      "position": {
        "x": 160.9400723408387,
        "y": 76.53329890718504
      },
      "icon": "IconData",
      "type": "node"
    },
    {
      "id": "stolen_hashes",
      "label": "Dumped NTLM Hashes",
      "position": {
        "x": -480.7856588926954,
        "y": -93.07238112618354
      },
      "icon": "IconStolenCredential",
      "type": "node"
    }
  ],
  "visibility": {
    "temp_hives": {
      "start": 4,
      "end": 6
    },
    "stolen_hashes": {
      "start": 6,
      "end": 100
    }
  },
  "steps": [
    {
      "id": 1,
      "name": "SMB Authentication",
      "mitre": {
        "id": "T1021.002",
        "tactic": "Lateral Movement",
        "technique": "Remote Services: SMB/Windows Admin Shares"
      },
      "type": "edge",
      "from": "secretsdump_tool",
      "to": "smb_service",
      "icon": "IconUser",
      "cli": "impacket-secretsdump marvel/fcastle:Password1@10.0.2.72"
    },
    {
      "id": 2,
      "name": "Check Remote Registry",
      "mitre": {
        "id": "T1021.002",
        "tactic": "Lateral Movement",
        "technique": "Remote Services: SMB/Windows Admin Shares"
      },
      "type": "edge",
      "from": "smb_service",
      "to": "scm_service",
      "icon": "IconService"
    },
    {
      "id": 3,
      "name": "Access Registry Hives",
      "mitre": {
        "id": "T1003.002",
        "tactic": "Credential Access",
        "technique": "OS Credential Dumping: Security Account Manager"
      },
      "type": "edge",
      "from": "scm_service",
      "to": "registry_store",
      "icon": "IconDatabase"
    },
    {
      "id": 4,
      "name": "Save Hives to Disk",
      "mitre": {
        "id": "T1003.002",
        "tactic": "Credential Access",
        "technique": "OS Credential Dumping: Security Account Manager"
      },
      "type": "edge",
      "from": "registry_store",
      "to": "temp_hives",
      "icon": "IconData"
    },
    {
      "id": 5,
      "name": "Retrieve Hive Files",
      "mitre": {
        "id": "T1003.002",
        "tactic": "Credential Access",
        "technique": "OS Credential Dumping: Security Account Manager"
      },
      "type": "edge",
      "from": "temp_hives",
      "to": "secretsdump_tool",
      "icon": "IconNetwork"
    },
    {
      "id": 6,
      "name": "Parse & Dump Hashes",
      "mitre": {
        "id": "T1003.004",
        "tactic": "Credential Access",
        "technique": "OS Credential Dumping: LSA Secrets"
      },
      "type": "edge",
      "from": "secretsdump_tool",
      "to": "stolen_hashes",
      "icon": "IconStolenCredential"
    }
  ]
}
