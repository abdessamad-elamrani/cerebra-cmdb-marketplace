{
  "title": "SMB Relay: SAM Hash Dumping",
  "version": "3.0",
  "viewport": {
    "zoom": 1.134993802935871,
    "pan": {
      "x": 406.6973674933924,
      "y": 110.93829037297614
    }
  },
  "entities": [
    {
      "id": "attacker_kali",
      "label": "Attacker (Kali)",
      "position": {
        "x": -217.04631937649447,
        "y": 148.22867093010117
      },
      "icon": "IconKali",
      "type": "container",
      "members": [
        "nmap_tool",
        "relay_tool",
        "stolen_hashes"
      ]
    },
    {
      "id": "nmap_tool",
      "label": "nmap",
      "position": {
        "x": -162.06424764196547,
        "y": 82.54820359978982
      },
      "icon": "IconTerminal",
      "type": "node"
    },
    {
      "id": "relay_tool",
      "label": "ntlmrelayx",
      "position": {
        "x": -263.52839111102344,
        "y": 192.90913826041253
      },
      "icon": "IconTerminal",
      "type": "node"
    },
    {
      "id": "stolen_hashes",
      "label": "Dumped Hashes",
      "position": {
        "x": -34.09145407738791,
        "y": 261.2218693212455
      },
      "icon": "IconStolenCredential",
      "type": "node"
    },
    {
      "id": "victim_network",
      "label": "Corporate Network",
      "position": {
        "x": 174.1022845651031,
        "y": 204.2883330920381
      },
      "icon": "IconCloud",
      "type": "container",
      "members": [
        "victim_user",
        "target_server"
      ]
    },
    {
      "id": "victim_user",
      "label": "Victim User",
      "position": {
        "x": 132.27317755656287,
        "y": 27.664423288135808
      },
      "icon": "IconUser",
      "type": "node"
    },
    {
      "id": "target_server",
      "label": "Target (10.0.2.73)",
      "position": {
        "x": 194.43139157364337,
        "y": 327.9122428959404
      },
      "icon": "IconServer",
      "type": "container",
      "members": [
        "smb_service",
        "sam_db"
      ]
    },
    {
      "id": "smb_service",
      "label": "SMB Service",
      "position": {
        "x": 194.43139157364337,
        "y": 286.9122428959404
      },
      "icon": "IconService",
      "type": "node"
    },
    {
      "id": "sam_db",
      "label": "SAM Database",
      "position": {
        "x": 194.43139157364337,
        "y": 347.9122428959404
      },
      "icon": "IconDatabase",
      "type": "node"
    }
  ],
  "visibility": {
    "stolen_hashes": {
      "start": 6,
      "end": 100
    }
  },
  "steps": [
    {
      "id": 1,
      "name": "Scan SMB Signing",
      "mitre": {
        "id": "T1046",
        "tactic": "Discovery",
        "technique": "Network Service Discovery"
      },
      "type": "edge",
      "from": "nmap_tool",
      "to": "smb_service",
      "icon": "IconTerminal",
      "cli": "nmap --script=smb2-security-mode.nse -p445 10.0.2.73"
    },
    {
      "id": 2,
      "name": "Start Relay",
      "mitre": {
        "id": "T1557.001",
        "tactic": "Credential Access",
        "technique": "Adversary-in-the-Middle: LLMNR/NBT-NS Poisoning and SMB Relay"
      },
      "type": "edge",
      "from": "attacker_kali",
      "to": "relay_tool",
      "icon": "IconTerminal",
      "cli": "impacket-ntlmrelayx -tf targets.txt -smb2support"
    },
    {
      "id": 3,
      "name": "Intercept Auth",
      "mitre": {
        "id": "T1557.001",
        "tactic": "Credential Access",
        "technique": "Adversary-in-the-Middle: LLMNR/NBT-NS Poisoning and SMB Relay"
      },
      "type": "edge",
      "from": "victim_user",
      "to": "relay_tool",
      "icon": "IconUser"
    },
    {
      "id": 4,
      "name": "Relay to Target",
      "mitre": {
        "id": "T1557.001",
        "tactic": "Credential Access",
        "technique": "Adversary-in-the-Middle: LLMNR/NBT-NS Poisoning and SMB Relay"
      },
      "type": "edge",
      "from": "relay_tool",
      "to": "smb_service",
      "icon": "IconNetwork"
    },
    {
      "id": 5,
      "name": "Access SAM",
      "mitre": {
        "id": "T1003.002",
        "tactic": "Credential Access",
        "technique": "OS Credential Dumping: Security Account Manager"
      },
      "type": "edge",
      "from": "smb_service",
      "to": "sam_db",
      "icon": "IconDatabase"
    },
    {
      "id": 6,
      "name": "Dump Hashes",
      "mitre": {
        "id": "T1003.002",
        "tactic": "Credential Access",
        "technique": "OS Credential Dumping: Security Account Manager"
      },
      "type": "edge",
      "from": "sam_db",
      "to": "stolen_hashes",
      "icon": "IconStolenCredential"
    }
  ]
}
